#!/bin/bash

export workdir=$(pwd)

clo() {
  case $4 in
    "overridable" )
      echo "deleting $1..."
      rm -rf "$1"
    ;;
    "updatable" )
      SYNC=true
    ;;
  esac
  if [ ! -d $1 ]; then
    echo "Cloning $2, branch $3"
    git clone "$2" "$1" -b "$3"
    echo
  else
    if [ $SYNC == true ]; then
      echo "syncing $1..."
      cd "$1"
      git pull
      cd $workdir
    else
      echo "$1 already exists and is not marked as updatable, skipping"
    fi
  fi
}

# device specific
clo device/xiaomi/selene https://github.com/TelegramAt25/android_device_xiaomi_selene $1 updatable
clo vendor/xiaomi/selene https://github.com/TelegramAt25/android_vendor_xiaomi_selene thirteen updatable
clo kernel/xiaomi/selene https://github.com/TelegramAt25/android_kernel_xiaomi_selene thirteen-stable updatable

# common
clo hardware/mediatek https://github.com/TelegramAt25/android_hardware_mediatek lineage-20 overridable
clo hardware/xiaomi https://github.com/PixelExperience/hardware_xiaomi thirteen
clo device/mediatek/sepolicy_vndr https://github.com/LineageOS/android_device_mediatek_sepolicy_vndr lineage-20 overridable

# compat hacks

# shims for camera
if [ ! -d hardware/custom/compat ]; then
  clo hardware/lineage/compat https://github.com/LineageOS/android_hardware_lineage_compat lineage-20.0	
fi

# audio
clo external/tinyxml https://github.com/PixelExperience/external_tinyxml thirteen
